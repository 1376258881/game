/*! H5拼图小游戏 */
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.Puzzle=e():t.Puzzle=e()}(window,function(){return o={},s.m=i=[function(t,e,i){"use strict";function o(t){this.init(t)}i.r(e),i.d(e,"default",function(){return o}),o.prototype={init:function(t){var e=this;this.initData(t),!this.isReset&&this.startBtn?(this.isReset=!0,this.render(this.isReset),this.handle(),setTimeout(function(){if(document.all)e.startBtn.click();else{var t=document.createEvent("MouseEvents");t.initEvent("click",!0,!0),e.startBtn.dispatchEvent(t)}},0)):(this.render(this.isReset),this.handle())},initData:function(t){var e=this;this.options=t,this.el=document.querySelector(t.el),this.oPuzzle=document.createElement("div"),this.startBtn=document.querySelector(t.data.startBtn)||!1,this.puzzleWidth=t.data.width,this.puzzleHeight=t.data.height,this.row=t.data.row,this.col=t.data.col,this.puzzleImg=t.data.puzzleImg,this.callBack=t.success||function(){},this.mounted=t.mounted||function(){},this.stepUpdate=t.stepUpdate||function(){},this.beforeHandle=t.beforeHandle,this.isReset=t.data.isReset||!1,this.blockWidth=this.puzzleWidth/this.col,this.blockHeiht=this.puzzleHeight/this.row,this.blockImgPosition=this.getBlockImgPosition(),this.blockPosition=this.getBlockPosition(),setTimeout(function(){e.oBlockMap=e.oPuzzle.getElementsByClassName("puzzle_block")},0),this.htmlFontSize=document.querySelector("html").style.fontSize,this.htmlFontSize&&(this.htmlFontSize=parseFloat(this.htmlFontSize)),this.modalID="puzzle_modal",this.bufferTime=t.data.bufferTime||".4s"},getBlockImgPosition:function(){for(var t=[],e=0;e<this.row;e++)for(var i=0;i<this.col;i++)t.push({x:i*this.blockWidth,y:e*this.blockHeiht});return t},getBlockPosition:function(){for(var t=[],e=0;e<this.blockImgPosition.length;e++)t[e]=this.blockImgPosition[e];return t.sort(function(){return Math.random()-.5}),t},render:function(t){for(var e="",i=0;i<this.blockPosition.length;i++){if(t)var o=this.blockImgPosition[i].x,s=this.blockImgPosition[i].y;else o=this.blockPosition[i].x,s=this.blockPosition[i].y;var n=this.blockImgPosition[i].x,l=this.blockImgPosition[i].y;e+="   \n                <div\n                    class='puzzle_block'\n                    style=\"\n                        width:".concat(this.blockWidth,"rem;\n                        height: ").concat(this.blockHeiht,"rem;\n                        background-image: url(").concat(this.puzzleImg,");\n                        background-position:").concat(-o,"rem ").concat(-s,"rem;\n                        background-size:").concat(this.puzzleWidth,"rem ").concat(this.puzzleHeight,"rem;\n                        position: absolute;\n                        box-sizing: border-box;\n                        top:").concat(l,"rem;\n                        left: ").concat(n,'rem;\n                    "                  \n                ></div>            \n            '),this.oPuzzle.innerHTML=e,this.oPuzzle.style.width=this.puzzleWidth+"rem",this.oPuzzle.style.height=this.puzzleHeight+"rem",this.oPuzzle.style.position="relative",this.oPuzzle.setAttribute("class","puzzle"),this.el.appendChild(this.oPuzzle)}},handle:function(){var s,n,l,r,a,h,c,u,e,i,d=this;this.resetImg();for(var t=document.querySelectorAll(".puzzle_block"),o=0;o<t.length;o++)t[o].addEventListener("touchstart",function(t){d.createModal(d.modalID),this.style.zIndex=100,c=event.target||event.srcElement,s=c.style.left,n=c.style.top,l=t.changedTouches[0].pageX/d.htmlFontSize-parseFloat(s),r=t.changedTouches[0].pageY/d.htmlFontSize-parseFloat(n),this.style.transition="none",d.oneFlag=!1}),t[o].addEventListener("touchmove",function(t){e=t.targetTouches[0].pageX/d.htmlFontSize-l,i=t.targetTouches[0].pageY/d.htmlFontSize-r,e<=-d.blockWidth/2?e=-d.blockWidth/2:e>=d.puzzleWidth-d.blockWidth/2&&(e=d.puzzleWidth-d.blockWidth/2),i<=-d.blockHeiht/2?i=-d.blockHeiht/2:i>=d.puzzleHeight-d.blockHeiht/2&&(i=d.puzzleHeight-d.blockHeiht/2),this.style.left=e+"rem",this.style.top=i+"rem",t.preventDefault()}),t[o].addEventListener("touchend",function(t){var e,i;(this.style.zIndex=0,this.style.transition="all "+d.bufferTime+" ease 0s",a=t.changedTouches[0].pageX/d.htmlFontSize-l,h=t.changedTouches[0].pageY/d.htmlFontSize-r,(u=d.change(c,a,h))==c)?(u.style.left=s,u.style.top=n):(u.style.transition="all "+d.bufferTime+" ease 0s",e=u.style.left,i=u.style.top,c.style.left=e,c.style.top=i,u.style.left=s,u.style.top=n);var o=document.getElementById(d.modalID);d.oPuzzle.removeChild(o),d.blockModal||(d.blockModal=!1)}),t[o].addEventListener("transitionend",function(){u&&c&&0==d.oneFlag&&(d.oneFlag=!0,d.stepUpdate(c,u),d.checkWin())});this.mounted()},createModal:function(t){var e=document.getElementById(t);e||((e=document.createElement("div")).id=t,e.style.cssText="position: absolute; left: 0; top: 0; right: 0; bottom: 0; z-index: 999;width:".concat(this.puzzleWidth,"rem;height:").concat(this.puzzleHeight,"rem"),this.oPuzzle.appendChild(e))},cellOrder:function(t){for(var e=t.length,i=0;i<e;i++)this.oBlockMap[i].style.transition="all 0.4s ease 0s",this.oBlockMap[i].style.left=t[i].x+"rem",this.oBlockMap[i].style.top=t[i].y+"rem"},change:function(t,e,i){for(var o=document.querySelectorAll(".puzzle_block"),s=0;s<o.length;s++)if(Math.abs(o[s].offsetLeft/this.htmlFontSize-e)<=this.blockWidth/2&&Math.abs(o[s].offsetTop/this.htmlFontSize-i)<=this.blockHeiht/2&&o[s]!=t)return o[s];return t},checkWin:function(){for(var t=!0,e=0;e<this.oBlockMap.length;e++){var i=this.oBlockMap[e],o=parseInt("-"+i.style.left),s=parseInt("-"+i.style.top),n=parseInt(i.style.backgroundPositionX),l=parseInt(i.style.backgroundPositionY);if(n!=o||l!=s){t=!1;break}}t&&0==this.isReset&&(this.oneFlag=!0,this.GameWin(this.callBack))},GameWin:function(t){this.isReset=!0,this.startBtn&&(this.startBtn.innerText="开始",this.startBtn.className+=" oPuzzle_start"),this.createModal(this.modalID),t()},resetImg:function(){if(this.startBtn){var e=this;if(e.isReset)this.startBtn.innerText="开始",this.startBtn.className+=" oPuzzle_start",this.startBtn.classList.remove("oPuzzle_reset"),e.createModal(e.modalID);else{this.startBtn.innerText="复原",this.startBtn.className+=" oPuzzle_reset",this.startBtn.classList.remove("oPuzzle_start");var t=document.getElementById(e.modalID);t&&e.oPuzzle.removeChild(t)}e.blockPosition=e.getBlockPosition(),this.startBtn.addEventListener("click",function(){var t=document.getElementById(e.modalID);e.isReset?(t&&e.oPuzzle.removeChild(t),e.isReset=!1,this.innerText="复原",this.className+=" oPuzzle_reset",this.classList.remove("oPuzzle_start"),e.blockPosition=e.getBlockPosition(),e.cellOrder(e.blockPosition)):(t||e.createModal(e.modalID),e.isReset=!0,this.innerText="开始",this.className+=" oPuzzle_start",this.classList.remove("oPuzzle_reset"),e.cellOrder(e.blockImgPosition))},!1)}}}}],s.c=o,s.d=function(t,e,i){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)s.d(i,o,function(t){return e[t]}.bind(null,o));return i},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="",s(s.s=0).default;function s(t){if(o[t])return o[t].exports;var e=o[t]={i:t,l:!1,exports:{}};return i[t].call(e.exports,e,e.exports,s),e.l=!0,e.exports}var i,o});